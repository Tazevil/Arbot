╔═══════════════════════════════════════════════════════════════════════════════╗
║                    ARBOT-MINIDB NAMING CONVENTION AUDIT                       ║
║                         DISCREPANCY ANALYSIS REPORT                           ║
║                            Generated: 2025-11-10                              ║
╚═══════════════════════════════════════════════════════════════════════════════╝

═══════════════════════════════════════════════════════════════════════════════
EXECUTIVE SUMMARY
═══════════════════════════════════════════════════════════════════════════════

SOURCE OF TRUTH: docs/knowledge/name_convention.json (v1.5, 2025-10-15)

PATTERN DEFINED:
  ^(?<file_ID>\d{4})_(?<detail>[A-Z0-9À-ÖØ-Ý]+(?:-[A-Z0-9À-ÖØ-Ý]+)*)_(?<viewtype>[A-Z]{3})\.(?<ext>jpg|jpeg|png|webp|tiff)$

FORMAT: NNNN_DETAIL_VIEWTYPE.ext
  - NNNN: 4-digit file ID (zone*1000 + cat*100 + img*10)
  - DETAIL: UPPERCASE, accents allowed, hyphens OK, NO spaces
  - VIEWTYPE: Exactly 3 UPPERCASE letters (PAN, GEN, DET, MAC, MGM, MGS, MGP, MGB, DEG)
  - ext: lowercase (jpg, jpeg, png, webp, tiff)

OPTIONAL: Date suffix before extension for CHANTIER photos (zone 0)
  Format: NNNN_DETAIL_VIEWTYPE_YYYYMMDD.ext


═══════════════════════════════════════════════════════════════════════════════
FINDING #1: CATEGORY DEFINITIONS MISMATCH
═══════════════════════════════════════════════════════════════════════════════

NAME_CONVENTION.JSON (Source of Truth):
  0: "VUE GENERALE"
  1: "PLOMBERIE"
  2: "BAIGNOIRE"
  3: "CARRELAGE"
  4: "FENETRE"
  5: "PLAFOND"
  6: "PLATRERIE"        <- CORRECT SPELLING (double E: PLATRERIE)
  7: "SANITAIRE"
  8: "PLACARD"
  9: "EXISTANT"         <- CATEGORY 9 DEFINED

FILES WITH DISCREPANCIES:

  [X] validate_pack.py (line 28):
      - Missing category 9 ("EXISTANT")
      - Line 28: CATS = {..., 6: "PLATERIE", 7: "SANITAIRE", 8: "PLACARD"}
      - PROBLEM: Category 9 not defined, needed for "EXISTANT" zone
      - PROBLEM: Typo "PLATERIE" instead of "PLATRERIE" (missing second E)

  [OK] build_manifest_strict.py (line 30):
      - CORRECT: All 10 categories (0-9) defined
      - Line 30: CAT = {..., 6: "PLATRERIE", ..., 9: "EXISTANT"}
      - CORRECT: Proper spelling "PLATRERIE"


═══════════════════════════════════════════════════════════════════════════════
FINDING #2: REGEX PATTERN INCONSISTENCIES
═══════════════════════════════════════════════════════════════════════════════

NAME_CONVENTION.JSON Pattern:
  ^(?<file_ID>\d{4})_(?<detail>[A-Z0-9À-ÖØ-Ý]+(?:-[A-Z0-9À-ÖØ-Ý]+)*)_(?<viewtype>[A-Z]{3})\.(?<ext>jpg|jpeg|png|webp|tiff)$

VALIDATION:
  - UPPERCASE enforcement: YES (A-Z only, no lowercase alternative)
  - Accents in DETAIL: YES (À-ÖØ-Ý range)
  - Hyphens in DETAIL: YES ((?:-...)+)
  - VIEWTYPE: 3 letters ONLY: YES ([A-Z]{3})
  - Optional date: NOT in pattern, but implied by examples


VALIDATE_PACK.PY (line 36-38) - THREE DIFFERENT PATTERNS:

  Case A: ^(\d{4})_([A-Z0-9]+(?:-[A-Z0-9]+)*)_([A-Z0-9]{2,6})_(\d{8})\.(jpg|jpeg|png|webp|tiff)$
    - PROBLEMS:
      o VIEWTYPE allows 2-6 chars ([A-Z0-9]{2,6}) NOT 3 chars
      o Uses [A-Z0-9] (digits allowed in viewtype) - should be [A-Z]{3}
      o Requires date only for zone 0, inflexible

  Case B: ^(\d{4})_([A-Z0-9]+(?:-[A-Z0-9]+)*)_(\d{4})\.(jpg|jpeg|png|webp|tiff)$
    - PROBLEM: Uses 4-digit year INSTEAD of 3-letter viewtype
    - INCOMPATIBLE with official pattern

  Case C: ^(\d{4})_([A-Z0-9]+(?:-[A-Z0-9]+)*)_([A-Z0-9]{2,6})\.(jpg|jpeg|png|webp|tiff)$
    - PROBLEMS:
      o VIEWTYPE allows 2-6 chars - should be {3}
      o Uses [A-Z0-9] - should be [A-Z]{3}


REGEX_REFERENCE.PY (line 11-17):

  Pattern: ^(?P<file_ID>\d{4})_(?P<detail>[A-Z0-9À-ÖØ-Ý]+)_(?P<viewtype>[A-Z]{3})(?:_(?P<date>\d{8}))?.(?P<ext>jpg|jpeg|png|webp|tiff)$
    - GOOD: Viewtype is {3} letters
    - GOOD: Pattern structure matches convention
    - ISSUE #1: re.IGNORECASE flag allows lowercase matching
      o Convention requires UPPERCASE ONLY
      o Should NOT use re.IGNORECASE
    - ISSUE #2: Detail pattern missing hyphen support
      o Uses: [A-Z0-9À-ÖØ-Ý]+
      o Should be: [A-Z0-9À-ÖØ-Ý]+(?:-[A-Z0-9À-ÖØ-Ý]+)*
      o Current pattern won't match "SALON-PROTECTION"


═══════════════════════════════════════════════════════════════════════════════
FINDING #3: ACTUAL IMAGE FILES VALIDATION
═══════════════════════════════════════════════════════════════════════════════

Sample of 94 actual files:
  0001_SDB_GEN_20250818.jpg           -> VALID (zone 0, has date)
  0003_SALON-PROTECTION_GEN_20250818.jpg -> VALID (zone 0, has date, hyphenated detail)
  2001_SDB_GEN.jpg                    -> VALID (zone 2, no date)
  2301_JOINT_MGM.jpg                  -> VALID (zone 2, detail=JOINT)
  2401_CARRELAGE-DESALIGNEMENT_DET.jpg -> VALID (zone 2, hyphenated detail)
  3601_JOINT_MGM.jpg                  -> VALID (zone 3)
  3705_PIED_DET.jpg                   -> VALID (zone 3)

ANALYSIS:
  - All 94 files follow the official naming convention pattern
  - Contain hyphens in detail field (SALON-PROTECTION, CARRELAGE-DESALIGNEMENT)
  - All viewtypes are exactly 3 letters
  - All in UPPERCASE
  - Zone 0 (CHANTIER) files have YYYYMMDD dates

═══════════════════════════════════════════════════════════════════════════════
CRITICAL ISSUES TO FIX
═══════════════════════════════════════════════════════════════════════════════

PRIORITY 1 (MUST FIX):
  1. validate_pack.py:
     - Add category 9 ("EXISTANT") to CATS dictionary
     - Fix PLATERIE -> PLATRERIE (correct spelling)
     - Replace 3-case pattern system with single unified pattern
     - Match the official regex from name_convention.json

  2. REGEX_REFERENCE.py:
     - REMOVE re.IGNORECASE flag (enforce uppercase)
     - Fix detail pattern to support hyphens:
       FROM: [A-Z0-9À-ÖØ-Ý]+
       TO: [A-Z0-9À-ÖØ-Ý]+(?:-[A-Z0-9À-ÖØ-Ý]+)*

PRIORITY 2 (SHOULD FIX):
  3. build_manifest_strict.py: Already correct, no changes needed

═══════════════════════════════════════════════════════════════════════════════
SUMMARY TABLE
═══════════════════════════════════════════════════════════════════════════════

File                          | Status    | Issues
-------------------------------|-----------|----------------------------------------------
name_convention.json           | [OK]      | Authoritative reference
manifest.json                  | [OK]      | Naming rules embedded (UPDATED)
README.md                      | [OK]      | Full documentation (UPDATED)
build_manifest_strict.py       | [OK]      | Correctly implements convention
REGEX_REFERENCE.py             | [WARN]    | Missing hyphen support, needs case enforcement
validate_pack.py               | [FAIL]    | Category missing, pattern mismatch, typo
Actual image files (94)        | [OK]      | All follow official convention


═══════════════════════════════════════════════════════════════════════════════
RECOMMENDATIONS
═══════════════════════════════════════════════════════════════════════════════

1. Update validate_pack.py to use official regex from name_convention.json
2. Fix REGEX_REFERENCE.py to enforce uppercase and support hyphens
3. Run validation on all 94 images against corrected patterns
4. Generate updated manifest_images.json with strict validation
5. Document which Python files implement the naming convention

═══════════════════════════════════════════════════════════════════════════════
